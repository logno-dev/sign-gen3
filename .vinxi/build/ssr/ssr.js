import{ssrElement as h,escape as m,mergeProps as E,ssr as u,renderToStream as A,getRequestEvent as q,createComponent as p,NoHydration as C,ssrHydrationKey as y,ssrAttribute as F}from"solid-js/web";import{toWebRequest as M,getRequestIP as H,setResponseHeader as g,setResponseStatus as v,appendResponseHeader as N,getResponseHeader as k,removeResponseHeader as I,getCookie as L,setCookie as P,eventHandler as O,sendRedirect as _,setHeader as j}from"h3";import{lazy as z,createComponent as B,sharedConfig as R}from"solid-js";import{provideRequestEvent as J}from"solid-js/web/storage";import{p as D,m as K}from"./assets/routes-0fb0d1aa.js";const T=Symbol("h3Event"),d=Symbol("fetchEvent"),U={get(e,n){return n===d?e:e[n]??e[T][n]}};function W(e){return new Proxy({request:M(e),clientAddress:H(e),locals:{},[T]:e},U)}function Y(e){if(!e[d]){const n=W(e);e[d]=n}return e[d]}const G=" ",Q={style:e=>h("style",e.attrs,()=>m(e.children),!0),link:e=>h("link",e.attrs,void 0,!0),script:e=>e.attrs.src?h("script",E(()=>e.attrs,{get id(){return e.key}}),()=>u(G),!0):null};function b(e){let{tag:n,attrs:{key:t,...s}={key:void 0},children:a}=e;return Q[n]({attrs:s,key:t,children:a})}function V(e,n,t,s="default"){return z(async()=>{{const r=(await e.import())[s],f=(await n.inputs?.[e.src].assets()).filter(i=>i.tag==="style"||i.attrs.rel==="stylesheet");return{default:i=>[...f.map(l=>b(l)),B(r,i)]}}})}function X(){function e(t){return{...t,...t.$$route?t.$$route.require().route:void 0,metadata:{...t.$$route?t.$$route.require().route.metadata:{},filesystem:!0},component:V(t.$component,globalThis.MANIFEST.client,globalThis.MANIFEST.ssr),children:t.children?t.children.map(e):void 0}}return D.map(e)}function Z(e){const n=L(e,"flash");if(!n)return;let t=JSON.parse(n);if(!t||!t.result)return[];const s=[...t.input.slice(0,-1),new Map(t.input[t.input.length-1])];return P(e,"flash","",{maxAge:0}),{url:t.url,result:t.error?new Error(t.result):t.result,input:s}}async function x(e){const n=globalThis.MANIFEST.client;return globalThis.MANIFEST.ssr,g(e,"Content-Type","text/html"),Object.assign(e,{manifest:await n.json(),assets:[...await n.inputs[n.handler].assets()],initialSubmission:Z(e),routes:X(),components:{status:s=>(v(e,s.code,s.text),()=>v(e,200)),header:s=>(s.append?N(e,s.name,s.value):g(e,s.name,s.value),()=>{const a=k(e,s.name);if(a&&typeof a=="string"){const r=a.split(", "),o=r.indexOf(s.value);o!==-1&&r.splice(o,1),r.length?g(e,s.name,r.join(", ")):I(e,s.name)}})},$islands:new Set})}function ee(e,n={}){return O({onRequest:n.onRequest,onBeforeResponse:n.onBeforeResponse,handler:t=>{const s=Y(t);return J(s,async()=>{const a=K(new URL(s.request.url).pathname,s.request.method);if(a){const c=(await a.handler.import())[s.request.method];return s.params=a.params,R.context={event:s},await c(s)}const r=await x(s);let o={...n};if(o.onCompleteAll){const l=o.onCompleteAll;o.onCompleteAll=c=>{w(r)(c),l(c)}}else o.onCompleteAll=w(r);if(o.onCompleteShell){const l=o.onCompleteShell;o.onCompleteShell=c=>{$(r,t)(),l(c)}}else o.onCompleteShell=$(r,t);const f=A(()=>(R.context.event=r,e(r)),o);if(r.response&&r.response.headers.get("Location"))return _(s,r.response.headers.get("Location"));const{writable:S,readable:i}=new TransformStream;return f.pipeTo(S),i})}})}function $(e,n){return()=>{e.response&&e.response.headers.get("Location")&&(v(n,302),j(n,"Location",e.response.headers.get("Location")))}}function w(e){return({write:n})=>{const t=e.response&&e.response.headers.get("Location");t&&n(`<script>window.location="${t}"<\/script>`)}}const te=["<script",">","<\/script>"],ne=["<script",' type="module"',"><\/script>"],se=u("<!DOCTYPE html>");function re(e){const n=q();return p(C,{get children(){return[se,p(e.document,{get assets(){return n.assets.map(t=>b(t))},get scripts(){return[u(te,y(),`window.manifest = ${JSON.stringify(n.manifest)}`),u(ne,y(),F("src",m(globalThis.MANIFEST.client.inputs[globalThis.MANIFEST.client.handler].output.path,!0),!1))]}})]}})}const oe=['<head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico">',"</head>"],ae=["<html",' lang="en">','<body><div id="app">',"</div><!--$-->","<!--/--></body></html>"],de=ee(()=>p(re,{document:({assets:e,children:n,scripts:t})=>u(ae,y(),p(C,{get children(){return u(oe,m(e))}}),m(n),m(t))}));export{de as default};
